<!doctype html>
<meta charset="utf-8" />
<h1>Equipment create helper</h1>
<p>What equipment do you want to create?
<p><select id="want"></select>
<p><strong>Basical material</strong>
<p id="basic">
<h2>Additional: what item(s) you already owned?</h2>
<p><select id="owned"></select> x<input type="number" value="1" id="num" style="width:22px" /> <button id="add">Add</button>
<p id="bank_head" style="display:none"><strong>Your bank:</strong>
<ul id="bank_content" style="display:none"></ul>
<p><button id="show">Show me what is I need to collect</button>
<script>
	var getJSON = function(path,callback){
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4){
				if(xhr.status == 200){
					var data = JSON.parse(xhr.responseText);
					xhr = null;
					callback(data);
				}else{
					xhr = null;
					alert('READ JSON ERROR!');
				}
			}
		}
		xhr.open('get',path,true);
		xhr.send();
	};

	var elWant = document.querySelector('#want'), elBasic = document.querySelector('#basic'), elOwned = document.querySelector('#owned'), elNum = document.querySelector('#num'), elAdd = document.querySelector('#add'), elBankHead = document.querySelector('#bank_head'), elBank = document.querySelector('#bank_content'), elShow = document.querySelector('#show');

	var addBasical = function(material,isChecked,isReadonly){
		var lable = document.createElement('label'), htw = '';
		htw = '<input type="checkbox"';
		if(isChecked){
			htw += ' checked="checked"';
		}
		if(isReadonly){
			htw += ' readonly="readonly"';
		}
		label.innerHTML = htw+' /> '+material;
		label.dataset.ma = material;
		elBasic.appendChild(label);
	};

	var originalMaterial = {}, defaultCollectableMaterial = {};

	getJSON('equipment.json',function(data){

		var splitEquipment = function(eq){
			if(eq in data){
				return data[eq];
			}
			return null;
		};

		for(var key in data){
			elWant.add(new Option(key));
			elOwned.add(new Option(key));
			for(var i=0,l=data[key].length;i<l;i++){
				if(!splitEquipment(data[key][i]) && !(data[key][i] in originalMaterial)){
					originalMaterial[data[key][i]] = 1;
					addBasical(data[key][i],true,true);
				}
			}
			addBasical(key,key in defaultCollectableMaterial,false);
		}

		var bank = {};

		elAdd.addEventListener('click',function(){
			if(elBankHead.style.cssText){
				elBankHead.style.cssText = '';
				elBank.style.cssText = '';
			}
			var eq = elOwned.value, sz = ~~elNum.value;
			if(bank[eq]){
				bank[eq]+=sz;
				elBank.querySelector('[data-eq="'+eq+'"]').innerHTML = eq+' x'+bank[eq]+' <a href="javascript:void(0)">[remove]</a>';
			}else{
				bank[eq]=sz;
				var li = document.createElement('li');
				li.innerHTML = eq+' x'+sz+' <a href="javascript:void(0)">[remove]</a>';
				li.dataset.eq = eq;
				elBank.appendChild(li);
			}
		},false);

		elBank.addEventListener('click',function(ev){
			if(ev.target.tagName.toLowerCase() == 'a'){
				var li = ev.target.parentNode;
				var eq = li.dataset.eq;
				delete bank[eq];
				elBank.removeChild(li);
				if(elBank.childElementCount==0){
					elBankHead.style.display='none';
					elBank.style.display='none';
				}
			}
		},false);

		elShow.addEventListener('click',function(){
			var eq = elWant.value;
		},false);

	});
</script>