<!doctype html>
<meta charset="utf-8" />
<h1>Equipment create helper</h1>
<p>What equipment do you want to create?
<p><select id="want"></select>
<h2>Additional: what item(s) you already owned?</h2>
<p><select id="owned"></select> x<input type="number" value="1" id="num" size="2" /> <button id="add">Add</button>
<p id="bank_head" style="display:none"><strong>Your bank:</strong>
<ul id="bank_content" style="display:none"></ul>
<p><button id="show">Show me what is I need to collect</button>
<script>
	var getJSON = function(path,data,callback){
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4){
				if(xhr.status == 200){
					data = JSON.parse(xhr.responseText);
					xhr = null;
					callback();
				}else{
					xhr = null;
					alert('READ JSON ERROR!');
				}
			}
		}
		xhr.open('get',path,true);
		xhr.send();
	};

	var elWant = document.querySelector('#want'), elOwned = document.querySelector('#owned'), elNum = document.querySelector('#num'), elAdd = document.querySelector('#add'), elBankHead = document.querySelector('#bank_head'), elBank = document.querySelector('#bank_content'), elShow = document.querySelector('#show');

	var data = null, bank = {};

	getJSON('equipment.json',data,function(){
		for(var key in data){
			elWant.add(new Option(key));
			elOwned.add(new Option(key));
		}
		elAdd.addEventListener('click',function(){
			if(elBankHead.style.cssText){
				elBankHead.style.cssText = '';
				elBank.style.cssText = '';
			}
			var eq = elOwned.value, sz = ~~elNum.value;
			if(bank[eq]){
				bank[eq]+=sz;
				elBank.querySelector('[data-eq="'+eq+'"]').innerHTML = eq+' x'+bank[eq];
			}else{
				bank[eq]=sz;
				var li = document.createElement('li');
				li.innerHTML = eq+' x'+sz;
				li.dataset.eq = eq;
				elBank.appendChild(li);
			}
		},false);
		elShow.addEventListener('click',function(){},false);
	});
</script>