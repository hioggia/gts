<!doctype html>
<meta charset="utf-8" />
<script>
	//UI-width / device-width * window.devicePixelRatio * 160
	var designWidth = 320;
	if(/Android/i.test(navigator.userAgent)){
		var dpi = Math.round(designWidth/window.screen.width*window.devicePixelRatio*160);
		document.write('<meta name="viewport" content="target-densitydpi='+dpi+',width='+designWidth+',user-scalable=no" />');
	}else{
		//var scale = window.innerWidth/320;
		document.write('<meta name="viewport" content="width='+designWidth+',user-scalable=no" />');
	}
</script>
<link rel="stylesheet" href="all.css" />
<body>
<div id="main_container">
	<div class="event_top">
		<h1>营业活动</h1>
	</div>
	<div class="custom_head">
		<h2>目标客户</h2>
		<span class="queue">
			<b class="u"></b>
			<b class="u"></b>
			<b class="a"></b>
			<b class="a"></b>
			<b class="a"></b>
		</span>
	</div>
	<div class="custom_box_c" data-custom-pic="305">
		<div class="price">9,000</div>
		<div class="name">近藤海</div>
		<div class="desc">刚刚与女友分手，心情很差，希望到这里可以重拾信心。</div>
		<div class="data_lay">
			<span class="like">纯洁</span>
			<span class="spec">优等生</span>
			<span class="affect">性感down</span>
		</div>
		<b class="chara_face"></b>
	</div>
	<div class="rival_head">
		<h2>竟争者</h2>
	</div>
	<div class="chara_band"><span>猫拖女仆咖啡屋</span></div>
	<div class="chara_box_s" data-chara-pic="9" data-bg-type="2">
		<div class="data_lay">
			<span class="name">シャルロッテ</span>
			<span class="age">17</span>
			<span class="fashion">SS</span>
			<span class="pure">C-</span>
			<span class="sexy">A+</span>
			<span class="technic">D</span>
			<span class="health">B+</span>
		</div>
		<div class="tag_lay">
			<span>逃学威龙</span>
			<span>露出癖</span>
			<span>善长交往</span>
		</div>
		<b class="chara_face"></b>
		<b class="tag_back"></b>
	</div>
	<div class="self_head">
		<h2>我</h2>
	</div>
	<div class="scroll_panel">
		<div class="scroll_container">
			<div class="scroll_node">
				<div class="chara_band">
					<span>大正浪漫女仆咖啡屋</span>
				</div>
				<div class="chara_box_s" data-chara-pic="15" data-bg-type="1">
					<div class="data_lay">
						<span class="name">レディ・グレイ</span>
						<span class="age">18</span>
						<span class="fashion">C+</span>
						<span class="pure">A-</span>
						<span class="sexy">B</span>
						<span class="technic">B-</span>
						<span class="health">A+</span>
					</div>
					<div class="tag_lay">
						<span>无经验</span>
						<span>巨乳</span>
						<span>死气沉沉</span>
						<span>劣等生</span>
						<span>呆毛</span>
					</div>
					<b class="chara_face"></b>
					<b class="tag_back"></b>
				</div>
			</div>
			<div class="scroll_node">
				<div class="chara_band">
					<span>大正浪漫女仆咖啡屋</span>
				</div>
				<div class="chara_box_s" data-chara-pic="16" data-bg-type="1">
					<div class="data_lay">
						<span class="name">レディ・グレイ</span>
						<span class="age">18</span>
						<span class="fashion">C+</span>
						<span class="pure">A-</span>
						<span class="sexy">B</span>
						<span class="technic">B-</span>
						<span class="health">A+</span>
					</div>
					<div class="tag_lay">
						<span>无经验</span>
						<span>巨乳</span>
						<span>死气沉沉</span>
						<span>劣等生</span>
						<span>呆毛</span>
					</div>
					<b class="chara_face"></b>
					<b class="tag_back"></b>
				</div>
			</div>
			<div class="scroll_node">
				<div class="chara_band">
					<span>大正浪漫女仆咖啡屋</span>
				</div>
				<div class="chara_box_s" data-chara-pic="17" data-bg-type="1">
					<div class="data_lay">
						<span class="name">レディ・グレイ</span>
						<span class="age">18</span>
						<span class="fashion">C+</span>
						<span class="pure">A-</span>
						<span class="sexy">B</span>
						<span class="technic">B-</span>
						<span class="health">A+</span>
					</div>
					<div class="tag_lay">
						<span>无经验</span>
						<span>巨乳</span>
						<span>死气沉沉</span>
						<span>劣等生</span>
						<span>呆毛</span>
					</div>
					<b class="chara_face"></b>
					<b class="tag_back"></b>
				</div>
			</div>
		</div>
	</div>
	<div class="scroll_point">
		<b class="curr"></b>
		<b></b>
		<b></b>
	</div>
	<div class="action">
		<button class="btn_blue btn_large">确定派出</button>
	</div>
	<div class="cover"><div class="cutin"></div></div>
</div>
<script>
var customerData = [
	{pic:305,name:'近藤海',desc:'刚刚与女友分手，心情很差，希望到这里可以重拾信心。',price:9000,like:'纯洁',spec:'优等生',affect:'性感down'}
], rivalData = {
	'猫拖女仆咖啡屋':[
		{pic:9,name:''}
	]
};
function close_cutin(){
	document.querySelector('.cover').style.display = 'none';
	document.querySelector('.cover').removeEventListener('touchend',close_cutin,false);
	document.querySelector('.cutin').style.display = 'none';
	document.querySelector('.cutin').innerHTML = '';
}
function cutin_control(stagePic,customer,rivals,mine,result){
	var pCounter = 1, cutinStage = document.querySelector('.cutin');
	document.querySelector('.cover').style.display = 'block';
	cutinStage.style.display = 'block';
	cutinStage.dataset.stagePic = stagePic;

	for(var i=0;i<rivals.length;i++){
		cutinStage.appendChild( createCutinHead(rivals[i],pCounter++,2) );
	}
	cutinStage.appendChild( createCutinHead(mine,pCounter,1) );
	cutinStage.dataset.totalChara = pCounter;

	var c = createCutinHead(customer,0,3);
	cutinStage.appendChild(c);
	c.innerHTML = '<b class="anim_ellipsis"></b>';
	setTimeout(function(){
		c.innerHTML = '';
		c.dataset.result = result;
		setTimeout(function(){
			c.innerHTML = '<b class="anim_heart"></b>';
			setTimeout(function(){
				document.querySelector('.cover').addEventListener('touchend',close_cutin,false);
			},600);
		},250);
	},4000);
}
function createCutinHead(charaPic,pos,borderType){
	var head = document.createElement('div');
	head.className = 'head';
	head.dataset.charaPic = charaPic;
	head.dataset.pos = pos;
	head.dataset.borderType = borderType;
	return head;
}

document.querySelector('.action button').addEventListener('touchend',function(){
	cutin_control(1,305,[9],15,2);
},false);

var nIndex = 0, recordingX = undefined, lockTime = 0;
function tweenScrolling(){
	if(lockTime==0){
		lockTime = new Date().getTime();
	}
	var delta = new Date().getTime() - lockTime;
	if(delta>=300){
		document.querySelector('.scroll_panel').scrollLeft = nIndex*320;
		lockTime = 0;
	}else{
		document.querySelector('.scroll_panel').scrollLeft += (nIndex*320 - document.querySelector('.scroll_panel').scrollLeft)*0.6;
		setTimeout(tweenScrolling,30);
	}
}
function recordMouseTouch(ev){
	ev.stopPropagation();
	ev.preventDefault();
	if(ev.type == 'touchstart'){
		if(lockTime>0){
			return;
		}
		recordingX = ev.touches[0].pageX;
	}else if(ev.type == 'touchmove'){
		if(recordingX!=undefined){
			document.querySelector('.scroll_panel').scrollLeft = nIndex*320+recordingX-ev.touches[0].pageX;
		}
	}else{
		var shift = document.querySelector('.scroll_panel').scrollLeft-nIndex*320;
		if(shift>=128){
			nIndex+=1;
		}else if(shift<=-128){
			nIndex-=1;
		}
		tweenScrolling();
		recordingX = undefined;
		document.querySelector('.scroll_point .curr').className = '';
		document.querySelectorAll('.scroll_point b')[nIndex].className = 'curr';
	}
}
document.querySelector('.scroll_panel').addEventListener('touchstart',recordMouseTouch,false);
document.querySelector('.scroll_panel').addEventListener('touchmove',recordMouseTouch,false);
document.querySelector('.scroll_panel').addEventListener('touchend',recordMouseTouch,false);
document.querySelector('.scroll_panel').addEventListener('touchcancel',recordMouseTouch,false);
</script>